# azure-pipelines.yml
trigger:
  - main  # Or adjust based on your branch naming

pool:
  vmImage: 'ubuntu-latest'

variables:
  # Update these values according to your Azure Container Registry
  containerRegistry: 'ACR'
  imageName: 'dvga'
  imageTag: '$(Build.BuildId)'
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'

stages:
- stage: Build
  displayName: 'Build and Push Docker Image'
  jobs:
  - job: BuildAndPush
    displayName: 'Build and Push'
    steps:
    - checkout: self
      displayName: 'Checkout Repository'
      
    - task: Docker@2
      displayName: 'Login to ACR'
      inputs:
        command: login
        containerRegistry: 'ACR'  # Replace with your Azure Container Registry service connection
        
    - task: Docker@2
      displayName: 'Build and Push Image'
      inputs:
        command: buildAndPush
        repository: $(imageName)
        dockerfile: $(dockerfilePath)
        containerRegistry: 'ACR'  # Replace with your Azure Container Registry service connection
        tags: |
          $(imageTag)
          latest
          
    - task: Docker@2
      displayName: 'Logout from ACR'
      inputs:
        command: logout
        containerRegistry: 'ACR'  # Replace with your Azure Container Registry service connection